# Проект: "SecureRestProxy"

1) [контроллер ProxyController](#контроллер-proxycontroller)
2) [контроллер SecurityController](#контроллер-securitycontroller) 
3) [класс UserCache](#класс-usercache)
4) [Модели данных](#модели-данных)
5) [Конфигурация безопасности SecurityConfig](#конфигурация-безопасности-securityconfig)
6) [Обработчик глобальных исключений](#обработчик-глобальных-исключений)
7) [Репозитории Spring Data JPA](#репозитории-spring-data-jpa)
8) [Классы для JSON сериализации](#классы-для-json-сериализации)
9) [Сервисы](#сервисы)
10) [Сервис AlbumService](#интерфейс-albumservice)
11) [Сервис AuditLogService](#интерфейс-AuditLogService)
12) [Сервис PostService](#интерфейс-PostService)
13) [Сервис SecurityService](#интерфейс-SecurityService)
14) [Сервис UserService](#интерфейс-UserService)
15) [Фаил application.properties](#properties)






# Контроллер ProxyController

Контроллер `ProxyController` обеспечивает взаимодействие с внешним API, проксируя `BASE_URL` для получения данных и отправки данных. 
Он также управляет данными пользователей, постов и альбомов в приложении.

- `BASE_URL`: Базовый URL внешнего API.

## Методы

### GET /api/users

- Описание: Получает список пользователей из внешнего API.
- Возвращает: Список пользователей.
- Обработка ошибок: Обрабатывает возможные ошибки HTTP.

### GET /api/posts

- Описание: Получает список постов из внешнего API.
- Возвращает: Список постов.
- Обработка ошибок: Обрабатывает возможные ошибки HTTP.

### GET /api/albums

- Описание: Получает список альбомов из внешнего API.
- Возвращает: Список альбомов.
- Обработка ошибок: Обрабатывает возможные ошибки HTTP.

### POST /api/users

- Описание: Создает нового пользователя и сохраняет его в базе данных. Поддерживет механизм кэширования объектов пользователей для ускорения работы с данными.
- Входные данные: Данные нового пользователя.
- Возвращает: Созданного пользователя.
- Обработка ошибок: Обрабатывает возможные ошибки HTTP.

### POST /api/posts

- Описание: Создает новый пост и сохраняет его в базе данных.
- Входные данные: Данные нового поста.
- Возвращает: Созданный пост.
- Обработка ошибок: Обрабатывает возможные ошибки HTTP.

### POST /api/albums

- Описание: Создает новый альбом и сохраняет его в базе данных.
- Входные данные: Данные нового альбома.
- Возвращает: Созданный альбом.
- Обработка ошибок: Обрабатывает возможные ошибки HTTP.

### DELETE /api/users

- Описание: Удаляет пользователя по его имени пользователя. Поддерживет механизм кэширования объектов пользователей для ускорения работы с данными.
- Входные данные: Имя пользователя.
- Обработка ошибок: Обрабатывает возможные ошибки HTTP.

### DELETE /api/posts

- Описание: Удаляет пост по его идентификатору.
- Входные данные: Идентификатор поста.
- Обработка ошибок: Обрабатывает возможные ошибки HTTP.

### DELETE /api/albums

- Описание: Удаляет альбом по его идентификатору.
- Входные данные: Идентификатор альбома.
- Обработка ошибок: Обрабатывает возможные ошибки HTTP.


# Класс UserCache

Класс `UserCache` предоставляет механизм кэширования объектов пользователей для ускорения работы с данными.

## Поля

- `userCache`: Коллекция для хранения объектов пользователей.

## Методы

### getUserFromCache(String userName)

- Описание: Получает пользователя из кэша по его имени.
- Входные данные: Имя пользователя.
- Возвращает: Объект пользователя из кэша.

### addToCache(User user)

- Описание: Добавляет пользователя в кэш.
- Входные данные: Объект пользователя для добавления в кэш.

### containsUser(String userName)

- Описание: Проверяет наличие пользователя в кэше.
- Входные данные: Имя пользователя.
- Возвращает: `true`, если пользователь найден в кэше, иначе `false`.

### removeFromCache(String userName)

- Описание: Удаляет пользователя из кэша.
- Входные данные: Имя пользователя.

## Использование

Класс `UserCache` предназначен для ускорения работы с данными путем кэширования объектов пользователей. При необходимости получения, добавления, проверки наличия или удаления пользователя, класс `UserCache` обеспечивает быстрый доступ к данным из оперативной памяти.


# Контроллер SecurityController

Контроллер `SecurityController` отвечает за управление данными безопасности, такими как пользователи, роли и пароли.

## Методы

### GET /api/security

- Описание: Получает список данных безопасности.
- Возвращает: Список данных безопасности.
- Обработка ошибок: Обрабатывает возможные ошибки HTTP.

### POST /api/security

- Описание: Создает новую запись в данных безопасности.
- Входные данные: Логин, роль и пароль для создания новой записи.
- Возвращает: Успешное сообщение об операции.
- Обработка ошибок: Обрабатывает возможные ошибки HTTP.

### DELETE /api/security

- Описание: Удаляет запись из данных безопасности по логину.
- Входные данные: Логин пользователя для удаления.
- Возвращает: Успешное сообщение об операции.
- Обработка ошибок: Обрабатывает возможные ошибки HTTP.

Контроллер `SecurityController` предоставляет возможность управления данными безопасности, включая создание, чтение и удаление записей о пользователях, ролях и паролях.


# Модели данных

Это основные модели, используемые в проекте для хранения данных пользователей, альбомов, постов, записей аудита и информации о безопасности.

## Модель User

Модель User представляет собой информацию о пользователе, включая его имя, учетные данные, контактную информацию, адрес проживания и информацию о работе. 
Уникальный индификатор: username;

**Таблица:** `users`  
**Столбцы:**
- `id`: Уникальный идентификатор пользователя.
- `name`: Имя пользователя.
- `username`: Имя пользователя в системе.
- `email`: Электронная почта пользователя.
- `address`: Адрес пользователя.
  - `street`: Улица.
  - `suite`: Дополнительная информация об адресе.
  - `city`: Город.
  - `zipcode`: Почтовый индекс.
  - `geo`: Географические координаты.
    - `lat`: Широта.
    - `lng`: Долгота.
- `phone`: Номер телефона пользователя.
- `website`: Веб-сайт пользователя.
- `company`: Информация о компании пользователя.
  - `name`: Название компании.
  - `catchPhrase`: Фраза компании.
  - `bs`: Основная сфера деятельности.


## Модель Album

Модель Album представляет альбомы, которые принадлежат определенным пользователям.
У пользователя может быть несколько альбомов.

**Таблица:** `albums`  
**Столбцы:**
- `id`: Уникальный идентификатор альбома.
- `userId`: Идентификатор пользователя, которому принадлежит альбом.
- `title`: Название альбома.

## Модель Post

Модель Post представляет собой посты, созданные пользователями.
У пользователя может быть несколько постов.

**Таблица:** `posts`  
**Столбцы:**
- `id`: Уникальный идентификатор поста.
- `userId`: Идентификатор пользователя, создавшего пост.
- `title`: Заголовок поста.
- `body`: Тело поста.

  
## Модель AuditLog

Модель AuditLog используется для ведения аудита действий пользователей в системе.

**Таблица:** `audit_log`  
**Столбцы:**
- `id`: Уникальный идентификатор записи аудита.
- `ipAddress`: IP-адрес, с которого был выполнен запрос.
- `loggedIn`: Флаг, указывающий, был ли выполнен вход.
- `date`: Дата и время выполнения действия.
- `login`: Логин пользователя, выполнившего действие.
- `methodName`: Название метода, для которого выполнялось действие.
- `parameters`: Параметры запроса.


## Модель Security

Модель Security используется для хранения информации о пользователях, их ролях и учетных данных.

**Таблица:** `security`  
**Столбцы:**
- `id`: Уникальный идентификатор записи о безопасности.
- `role`: Роль пользователя.
- `login`: Логин пользователя.
- `password`: Пароль пользователя.

# Конфигурация безопасности SecurityConfig

Класс `SecurityConfig` отвечает за настройку безопасности веб-приложения с использованием Spring Security.

## Роли и права доступа

| Роль      | Права доступа                                   |
|-----------|------------------------------------------------|
| ADMIN     | Полные права на все ресурсы                    |
| EDITOR    | Права на редактирование                         |
| VIEWER    | Ограниченные права на чтение                   |
| USERS     | Доступ к управлению пользователями              |
| POSTS     | Доступ к управлению постами                     |
| ALBUMS    | Доступ к управлению альбомами                   |
| SECURITY  | Доступ к управлению безопасностью                |

## Механизмы аутентификации

- Базовая аутентификация HTTP используется для проверки подлинности пользователей при каждом запросе.
- Пароли пользователей хранятся в зашифрованном виде с использованием `BCryptPasswordEncoder`.

## HTTP Методы и Права доступа

Для каждого HTTP метода и конечной точки (`/api/posts/**`, `/api/users/**`, `/api/albums/**`, `/api/security/**`), определены различные права доступа в зависимости от роли пользователя.

| Метод     | Ресурс               | Права доступа                     |
|-----------|----------------------|----------------------------------|
| GET       | /api/posts/**       | POSTS, EDITOR, ADMIN             |
| GET       | /api/users/**       | USERS, EDITOR, ADMIN             |
| GET       | /api/albums/**      | ALBUMS, EDITOR, ADMIN            |
| GET       | /api/security/**    | SECURITY, EDITOR, ADMIN          |
| POST      | /api/posts/**       | POSTS, VIEWER, ADMIN             |
| POST      | /api/users/**       | USERS, VIEWER, ADMIN             |
| POST      | /api/albums/**      | ALBUMS, VIEWER, ADMIN            |
| POST      | /api/security/**    | SECURITY, VIEWER, ADMIN          |
| DELETE    | /api/posts/**       | POSTS, VIEWER, ADMIN             |
| DELETE    | /api/users/**       | USERS, VIEWER, ADMIN             |
| DELETE    | /api/albums/**      | ALBUMS, VIEWER, ADMIN            |
| DELETE    | /api/security/**    | SECURITY, VIEWER, ADMIN          |

Класс `SecurityConfig` определяет, как пользователи веб-приложения будут аутентифицироваться и авторизовываться, а также какие права доступа предоставляются каждой роли.

# Обработчик глобальных исключений

Класс `GlobalExceptionHandler` является компонентом Spring, предназначенным для обработки исключений, возникающих в приложении.

## Описание класса GlobalExceptionHandler

- Аннотация `@ControllerAdvice` указывает, что данный класс является глобальным обработчиком исключений для всех контроллеров в приложении.

- Метод `handleCustomException` отвечает за обработку исключений типа `CustomException`. При возникновении такого исключения формируется объект `ResponseEntity` с информацией об ошибке в формате JSON.

## Класс CustomException

Класс `CustomException` является пользовательским исключением, которое может быть выброшено в различных частях приложения.

### Поля класса CustomException

- `errorCode` - код ошибки
- `message` - сообщение об ошибке

## Таблица кодов ошибок и сообщений исключений

| Имя исключения           | Код ошибки |
|--------------------------|------------|
| USER_NOT_FOUND           | 1          |
| USER_ALREADY_EXISTS      | 2          |
| SECURITY_NOT_FOUND       | 3          |
| SECURITY_ALREADY_EXISTS  | 4          |
| ROLE_NOT_FOUND           | 5          |
| POST_NOT_FOUND           | 6          |
| ALBUM_NOT_FOUND          | 7          |

Исключения отлавливаются и обрабатываются автоматически, а затем формируются в ответ в виде JSON объекта с соответствующим кодом ошибки и сообщением.

# Репозитории Spring Data JPA

Spring Data JPA предоставляет мощный механизм для работы с базами данных, позволяя создавать репозитории для доступа к данным с минимальными усилиями. Ниже представлены репозитории, которые используются для работы с сущностями в базе данных.

## AlbumRepository

| Метод                   | Описание                                                                    |
|-------------------------|-----------------------------------------------------------------------------|
| findById                | Поиск альбома по его идентификатору                                         |
| deleteById              | Удаление альбома по его идентификатору                                      |
| findByUserId            | Поиск альбомов по идентификатору пользователя                               |

## AuditLogRepository

Репозиторий `AuditLogRepository` расширяет интерфейс `JpaRepository` без добавления дополнительных методов.

## PostRepository

| Метод                   | Описание                                                                    |
|-------------------------|-----------------------------------------------------------------------------|
| findById                | Поиск поста по его идентификатору                                            |
| deleteById              | Удаление поста по его идентификатору                                         |
| findByUserId            | Поиск постов по идентификатору пользователя                                  |

## SecurityRepository

| Метод                   | Описание                                                                    |
|-------------------------|-----------------------------------------------------------------------------|
| findByLoginAndRole      | Поиск безопасности по имени пользователя и роли                             |
| findByLogin             | Поиск безопасности по имени пользователя                                     |
| findAll                 | Получение списка всех безопасностей                                          |
| deleteByLogin           | Удаление безопасности по имени пользователя                                 |

## UserRepository

| Метод                   | Описание                                                                    |
|-------------------------|-----------------------------------------------------------------------------|
| findById                | Поиск пользователя по его идентификатору                                     |
| findByUsername          | Поиск пользователя по его имени пользователя                                 |
| findAll                 | Получение списка всех пользователей                                          |
| deleteByUsername        | Удаление пользователя по его имени                                           |
| deleteById              | Удаление пользователя по его идентификатору                                   |



# Классы для JSON сериализации

В рамках проекта используются аннотации и классы для сериализации объектов в формат JSON. Ниже приведены классы и аннотации, используемые для этой цели.

## AlbumResponseMessage

Класс `AlbumResponseMessage`используется для ответа, содержащего информацию об альбомах.

## PostResponseMessage

Класс `PostResponseMessage` используется для ответа, содержащего информацию о постах.  

## ResponseMessage

Класс `ResponseMessage` представляет базовое сообщение ответа сервера. Он содержит основные поля, такие как статус, сообщение и код ответа.

## SecurityResponseMessage

Класс `SecurityResponseMessage` используется для представления ответа, содержащего информацию о безопасности.

## UserResponseMessage

Класс `UserResponseMessage`используется для представления ответа, содержащего информацию о пользователях.

Все эти классы помечены аннотацией `@JsonInclude(JsonInclude.Include.NON_NULL)`, чтобы игнорировать поля, содержащие значение `null` при сериализации в JSON. Поля этих классов также аннотированы аннотацией `@JsonProperty`, которая позволяет задать альтернативное имя поля в JSON.

# Сервисы

## Интерфейс AlbumService 

Публичный интерфейс `AlbumService` определяет методы для управления альбомами.

### Методы:

- `save(Album album) throws CustomException`: Сохраняет альбом в системе. Может выбрасывать `CustomException`.
- `deleteById(Long id) throws CustomException`: Удаляет альбом по его идентификатору. Может выбрасывать `CustomException`.
- `findById(Long id) throws CustomException`: Возвращает альбом по его идентификатору. Может выбрасывать `CustomException`.
- `deleteByUserId(Long userId) throws CustomException`: Удаляет все альбомы пользователя по его идентификатору. Может выбрасывать `CustomException`.
- `findByUserId(Long userId) throws CustomException`: Возвращает список альбомов пользователя по его идентификатору. Может выбрасывать `CustomException`.

### Реализация:

Интерфейс `AlbumService` имеет реализацию в классе `AlbumServiceImpl`. Этот класс предоставляет конкретную реализацию методов интерфейса `AlbumService`, включая сохранение, удаление и поиск альбомов в базе данных. Он использует `AlbumRepository` для взаимодействия с базой данных и `UserService` для выполнения операций, связанных с пользователями. Класс `AlbumServiceImpl` обеспечивает бизнес-логику управления альбомами и обработки исключений при работе с ними.

## Интерфейс AuditLogService 

Публичный интерфейс `AuditLogService` определяет методы для управления журналом аудита.

### Методы:

- `save(AuditLog log)`: Сохраняет запись аудита в системе.

## Реализация:

Интерфейс `AuditLogService` имеет реализацию в классе `AuditLogServiceImpl`. Этот класс предоставляет конкретную реализацию методов интерфейса `AuditLogService`, включая сохранение записей аудита в базе данных. Он использует `AuditLogRepository` для взаимодействия с базой данных. Класс `AuditLogServiceImpl` обеспечивает сохранение информации о действиях в системе для последующего анализа и отслеживания.

## Интерфейс PostService

Публичный интерфейс `PostService` определяет методы для управления постами.

### Методы:

- `save(Post post) throws CustomException`: Сохраняет пост в системе. Может выбрасывать `CustomException`.
- `deleteById(Long id) throws CustomException`: Удаляет пост по его идентификатору. Может выбрасывать `CustomException`.
- `findById(Long id) throws CustomException`: Возвращает пост по его идентификатору. Может выбрасывать `CustomException`.
- `deleteByUserId(Long userId) throws CustomException`: Удаляет все посты пользователя по его идентификатору. Может выбрасывать `CustomException`.
- `findByUserId(Long userId) throws CustomException`: Возвращает список постов пользователя по его идентификатору. Может выбрасывать `CustomException`.

### Реализация:

Интерфейс `PostService` имеет реализацию в классе `PostServiceImpl`. Этот класс предоставляет конкретную реализацию методов интерфейса `PostService`, включая сохранение, удаление и поиск постов в базе данных. Он использует `PostRepository` для взаимодействия с базой данных и `UserService` для выполнения операций, связанных с пользователями. Класс `PostServiceImpl` обеспечивает бизнес-логику управления постами и обработки исключений при работе с ними.
## Интерфейс `SecurityService`

Публичный интерфейс `SecurityService` определяет методы для управления безопасностью пользователей.

### Методы:

- `save(Security security) throws CustomException`: Сохраняет данные о безопасности в системе. Может выбрасывать исключение `CustomException`.
- `findAll() throws CustomException`: Возвращает список всех данных о безопасности в системе. Может выбрасывать исключение `CustomException`.
- `delete(String login) throws CustomException`: Удаляет данные о безопасности по логину пользователя. Может выбрасывать исключение `CustomException`.
- `findByLogin(String login) throws CustomException`: Возвращает данные о безопасности пользователя по его логину. Может выбрасывать исключение `CustomException`.
- `isValidRole(String role) throws CustomException`: Проверяет, является ли роль допустимой. Может выбрасывать исключение `CustomException`.

### Реализация:

Интерфейс `SecurityService` имеет реализацию в классе `SecurityServiceImpl`. Этот класс предоставляет конкретную реализацию методов интерфейса `SecurityService`, включая сохранение, удаление и поиск данных о безопасности в базе данных. Класс `SecurityServiceImpl` использует `SecurityRepository` для взаимодействия с базой данных. Он обеспечивает проверку допустимости роли и обработку исключений при работе с данными о безопасности пользователей.

### Enum RoleEnum

| Роль            | Описание                             |
|-----------------|--------------------------------------|
| ADMIN           | Администратор                        |
| POSTS           | Публикация постов                    |
| USERS           | Управление пользователями            |
| ALBUMS          | Управление альбомами                 |
| SECURITY        | Управление безопасностью             |
| VIEWER          | Просмотр                            |
| EDITOR          | Редактирование                       |

## Интерфейс `UserService`

Публичный интерфейс `UserService` определяет методы для управления пользователями.

### Методы:

- `findAll() throws CustomException`: Возвращает список всех пользователей. Может выбрасывать исключение `CustomException`.
- `findById(Long id) throws CustomException`: Возвращает пользователя по его идентификатору. Может выбрасывать исключение `CustomException`.
- `save(User user) throws CustomException`: Сохраняет пользователя в системе. Может выбрасывать исключение `CustomException`.
- `findByUsername(String username) throws CustomException`: Возвращает пользователя по его имени пользователя. Может выбрасывать исключение `CustomException`.
- `deleteByUsername(String username) throws CustomException`: Удаляет пользователя по его имени пользователя. Может выбрасывать исключение `CustomException`.
- `deleteById(Long id) throws CustomException`: Удаляет пользователя по его идентификатору. Может выбрасывать исключение `CustomException`.

### Реализация:

Интерфейс `UserService` имеет реализацию в классе `UserServiceImpl`. Этот класс предоставляет конкретную реализацию методов интерфейса `UserService`, включая поиск, сохранение и удаление пользователей в базе данных. Класс `UserServiceImpl` использует `UserRepository` для взаимодействия с базой данных. Он обеспечивает проверку существования пользователей и обработку исключений при работе с ними.

# properties

# Настройки для подключения к базе данных PostgreSQL
spring.datasource.type=                       # Тип источника данных (например, com.zaxxer.hikari.HikariDataSource)
spring.datasource.url=                        # URL для подключения к базе данных PostgreSQL
spring.datasource.hikari.username=           # Имя пользователя базы данных PostgreSQL
spring.datasource.hikari.password=           # Пароль пользователя базы данных PostgreSQL

# Настройки Hibernate
spring.jpa.properties.hibernate.hbm2ddl.auto= # Стратегия создания и обновления схемы базы данных
spring.jpa.properties.hibernate.show_sql=     # Флаг для отображения SQL-запросов в консоли

# Настройки порта сервера
server.port=                                  # Порт, на котором будет запущен сервер

# Настройки для входа в систему 
admin.login=                                  # Логин администратора
admin.password=                               # Пароль администратора
admin.role=                                   # Роль администратора (например, ADMIN)


